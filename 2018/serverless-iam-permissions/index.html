<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Stanley Zheng"><meta name=description content="Programmer Blog, trying to share insights and knowledge picked up along the way."><meta name=generator content="Hugo 0.58.3"><title>Serverless IAM Permissions &middot; Stanley Zheng</title><link rel="shortcut icon" href=https://blog.zheng.nyc/images/favicon.ico><link rel=stylesheet href=https://blog.zheng.nyc/css/style.css><link rel=stylesheet href=https://blog.zheng.nyc/css/highlight.css><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css><link href=https://blog.zheng.nyc/index.xml rel=alternate type=application/rss+xml title="Stanley Zheng"></head><body><nav class=main-nav><a href=https://blog.zheng.nyc/>Home</a>
<a href=https://stanley.zheng.nyc/>About</a></nav><section id=wrapper><article class=post><header><h1>Serverless IAM Permissions</h1><h2 class=headline>February 1, 2018<br><a href=https://blog.zheng.nyc/tags/aws>AWS</a></h2></header><section id=post-body><p>How do we create an IAM (Identity Access Management) user with the bare minimum permissions to access the resources it needs for Serverless? What do the individual IAM services and permissions mean?</p><h2 id=intro>Intro</h2><p>In the wonderful world of Amazon lambda, you write the function code and execute it on Amazon&rsquo;s infrastructure. But outside of just Amazon Lambda there are multiple other Amazon resources your Lambda taps into including API Gateway, Cloudformation and more depending on what you&rsquo;re doing. To tap into these different services programmatically, you can setup and configure a tool like the <code>awscli</code> and create a user on Amazon IAM through the admin interface. When you create the user, you can grant it programmatic access.</p><p>With a tool like Serverless, it utilizes the AWS APIs to programmatically manage Amazon resources on your behalf. But all these methods relinquish control of your resources to a 3rd party.</p><p>You can use <code>AdministratorAccess</code> to give a whitelist for your user to do everything but it makes your system accessible to everyone. Whether the script is then able to touch resources its not suppose to or the user role is compromised and you&rsquo;ve now opened up more of your system.</p><p>It&rsquo;s nice to give it just the permission it needs but let&rsquo;s understand the services and the permissions they use.</p><h2 id=permissions>Permissions</h2><p>With all IAM roles, there are policies. Amazon provides a few IAM role templates they manage for common policies; Users are also allowed to customize and define their own User policies.</p><h3 id=lambda>Lambda</h3><p>To run your lambdas of course you need some IAM Lambda* Access.
Amazon provides some broad templates like <code>AWSLambdaFullAccess</code> which give access to all services Lambda can hit (S3, Dynamo, Kinesis). But the permission can be as fine grain as <code>AWSLambdaExecute</code> which only gives it access to send requests to CloudWatch.</p><p>### API Gateway</p><p>If you want to hit your lambda from the public internet, you will need an API Gateway. This gives Amazon a place to redirect your requests to specific lambdas and URL mapping. Typically <code>AWSStorageGatewayFullAccess</code> is used to manage endpoints by serverless.</p><p>### Cloudformation</p><p>Cloudformation templates are templates to create infrastructure on Amazon. They&rsquo;re YAML based but very powerful and flexible. Serverless uses this in the background to manage other services also. Amazon doesn&rsquo;t provide except a read-only template <code>AWSCloudFormationReadOnlyAccess</code> as of now. You will have to define a custom definition if you want to give serverless access to cloudformation.</p><p>A policy discussed here, you can define as JSON version templates will allow serverless to create and build Stacks as it needs. When you define a new policy give it a relevant name such as <code>CloudFormationFullAccess</code> and tag it with the below JSON policy.</p><pre><code>{
    &quot;Version&quot;: &quot;2012-10-17&quot;,
    &quot;Statement&quot;: [
        {
            &quot;Sid&quot;: &quot;Stmt1449904348000&quot;,
            &quot;Effect&quot;: &quot;Allow&quot;,
            &quot;Action&quot;: [
                &quot;cloudformation:CreateStack&quot;,
                &quot;cloudformation:CreateChangeSet&quot;,
                &quot;cloudformation:ListStacks&quot;,
                &quot;cloudformation:UpdateStack&quot;,
                &quot;cloudformation:DeleteStack&quot;,
                &quot;cloudformation:Describe*&quot;,
                &quot;cloudformation:ExecuteChangeSet&quot;,
                &quot;cloudformation:ValidateTemplate&quot;
            ],
            &quot;Resource&quot;: [
                &quot;*&quot;
            ]
        }
    ]
}
</code></pre><h3 id=other-permissions>Other Permissions</h3><p>Other permissions can be done on a case by case basis. I wanted to under the hood the minimum number of resources you needed to interact with Serverless through terraform <a href=https://github.com/tealtail/wildryde-terraform-serverless>here</a>.</p><p>Being its an uncommon ask there were already questions about this on the github serverless forum. This user here <a href=https://github.com/serverless/serverless/issues/588>berry2012 generated a full list</a> from their finding that I found super helpful also to further my understanding.</p><p>Both policies can be found standalone in gist form here <a href=https://gist.github.com/stanzheng/abaf61555d8820b3d6bede0e156b1e19>https://gist.github.com/stanzheng/abaf61555d8820b3d6bede0e156b1e19</a></p></section></article><footer id=post-meta class=clearfix><a href=https://twitter.com/stanzheng><img class=avatar src="https://avatars0.githubusercontent.com/u/3683993?v=3&s=466"><div><span class=dark>Stanley Zheng</span>
<span>Polyglot who loves to experiment and explore</span>
<span><i class=rc-scout></i>Want to become a better programmer? <a href="https://www.recurse.com/scout/click?t=710ee58e0b0ad8d9f443f9c9440137f1">Join the Recurse Center!</a></span></div></a><section id=sharing><a class=twitter href="https://twitter.com/intent/tweet?text=https%3a%2f%2fblog.zheng.nyc%2f2018%2fserverless-iam-permissions%2f - Serverless%20IAM%20Permissions by @stanzheng"><span class=icon-twitter>Tweet</span></a></section></footer><footer id=footer><div id=social><a class=symbol href=https://www.github.com/stanleyzhengnyc><i class="fa fa-github"></i></a><a class=symbol href=https://www.instagram.com/stanleyzhengnyc><i class="fa fa-instagram"></i></a><a class=symbol href=https://www.linkedin.com/in/stanley-zheng><i class="fa fa-linkedin"></i></a><a class=symbol href=/index.xml><i class="fa fa-rss"></i></a><a class=symbol href=https://www.twitter.com/stanleyzhengnyc><i class="fa fa-twitter"></i></a></div><p class=small>Â© Copyright 2020 Stanley Zheng</p></footer></section><script src=//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js></script><script src=https://blog.zheng.nyc/js/main.js></script><script src=https://blog.zheng.nyc/js/highlight.js></script><script>hljs.initHighlightingOnLoad();</script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-73744856-3','auto');ga('send','pageview');}</script></body></html>